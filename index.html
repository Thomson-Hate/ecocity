<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EcoCity ‚Äî –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω–∞—è —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∞—è –∏–≥—Ä–∞</title>
<style>
/* ===== –°—Ç–∏–ª–∏ ===== */
* { margin:0; padding:0; box-sizing:border-box; font-family: sans-serif; }
body { background: linear-gradient(to bottom, #a0c4ff, #caf0f8); color: #333; }
#game-container { width: 100%; max-width: 1300px; margin: 20px auto; }
#top-bar {
    display: flex; justify-content: space-around; padding: 10px; background: rgba(255,255,255,0.2);
    backdrop-filter: blur(10px); border-radius: 10px; margin-bottom: 10px;
}
#main { display: flex; gap: 20px; }
#city-map {
    display: grid; grid-template-columns: repeat(12, 50px); grid-template-rows: repeat(12, 50px);
    gap: 2px; background: rgba(255,255,255,0.1); padding: 5px; border-radius: 10px; backdrop-filter: blur(5px);
}
.cell { width:50px; height:50px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
    display:flex; align-items:center; justify-content:center; font-size:24px; cursor:pointer; }
#sidebar { width:280px; background: rgba(255,255,255,0.15); padding: 15px; border-radius: 10px; backdrop-filter: blur(10px); }
button { width: 100%; margin:5px 0; padding: 10px; border:none; border-radius:5px; cursor:pointer; background: #90e0ef; color: #000; font-weight: bold; }
button:hover { background: #48cae4; }
#events { margin-top: 20px; max-height: 300px; overflow-y: auto; background: rgba(255,255,255,0.1); padding: 5px; border-radius: 5px; }
</style>
</head>
<body>
<div id="game-container">
    <div id="top-bar">
        <div>üí∞ –î–µ–Ω—å–≥–∏: <span id="money">0</span></div>
        <div>üè† –ù–∞—Å–µ–ª–µ–Ω–∏–µ: <span id="population">0</span></div>
        <div>üòä –°—á–∞—Å—Ç—å–µ: <span id="happiness">0</span>%</div>
        <div>‚ö° –≠–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏—è: <span id="electricity">0</span></div>
        <div>üíß –í–æ–¥–∞: <span id="water">0</span></div>
        <div>üçé –ï–¥–∞: <span id="food">0</span></div>
    </div>
    <div id="main">
        <div id="city-map"></div>
        <div id="sidebar">
            <h2>–í—ã–±–µ—Ä–∏—Ç–µ –∑–¥–∞–Ω–∏–µ –¥–ª—è —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞</h2>
            <button onclick="selectBuilding('residential')">üèò –ñ–∏–ª–æ–π –¥–æ–º (100$)</button>
            <button onclick="selectBuilding('industrial')">üè≠ –§–∞–±—Ä–∏–∫–∞ (200$)</button>
            <button onclick="selectBuilding('power')">‚ö° –≠–ª–µ–∫—Ç—Ä–æ—Å—Ç–∞–Ω—Ü–∏—è (150$)</button>
            <button onclick="selectBuilding('farm')">üåæ –§–µ—Ä–º–∞ (120$)</button>
            <div id="events"></div>
        </div>
    </div>
</div>

<script>
// =================== –ö–ª–∞—Å—Å—ã ===================
class Building {
    constructor(name,type,cost,upkeep,production,icon){
        this.name = name;
        this.type = type;
        this.cost = cost;
        this.upkeep = upkeep;           // {money, electricity, water, food}
        this.production = production;   // {money, electricity, water, food, population}
        this.icon = icon;
    }
}

class City {
    constructor(width,height){
        this.width = width;
        this.height = height;
        this.money = 5000;
        this.population = 50;
        this.happiness = 100;
        this.resources = { electricity:50, water:50, food:50 };
        this.buildings = []; // {building, x, y}
    }

    addBuilding(building,x,y){
        if(this.money < building.cost){ logEvent("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥!"); return false; }
        if(this.buildings.some(b=>b.x===x && b.y===y)){ logEvent("–ö–ª–µ—Ç–∫–∞ –∑–∞–Ω—è—Ç–∞!"); return false; }

        this.money -= building.cost;
        this.buildings.push({building,x,y});
        logEvent(`–ü–æ—Å—Ç—Ä–æ–µ–Ω–æ: ${building.name} –Ω–∞ (${x+1},${y+1})`);
        return true;
    }

    tick(){
        // —Å–±—Ä–æ—Å —Ä–µ—Å—É—Ä—Å–æ–≤
        let moneyChange = 0;
        let electricity = 50;
        let water = 50;
        let food = 50;
        let population = 50;

        this.buildings.forEach(b=>{
            moneyChange -= b.building.upkeep.money||0;
            electricity += b.building.production.electricity||0;
            water += b.building.production.water||0;
            food += b.building.production.food||0;
            population += b.building.production.population||0;
            moneyChange += b.building.production.money||0;
        });

        this.money += moneyChange;
        this.resources.electricity = electricity;
        this.resources.water = water;
        this.resources.food = food;
        this.population = population;

        // —Å—á–∞—Å—Ç—å–µ
        let penalty = 0;
        if(this.resources.electricity<0) penalty +=10;
        if(this.resources.water<0) penalty +=10;
        if(this.resources.food<this.population) penalty +=10;
        this.happiness = Math.max(0,100-penalty);
    }
}

// =================== –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ===================
const city = new City(12,12);
const mapDiv = document.getElementById('city-map');
const eventsDiv = document.getElementById('events');
let selectedBuilding = null;

// –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∑–¥–∞–Ω–∏–π
const buildingTypes = {
    residential: new Building("–ñ–∏–ª–æ–π –¥–æ–º","residential",100,{money:0},{population:10},'üè†'),
    industrial: new Building("–§–∞–±—Ä–∏–∫–∞","industrial",200,{money:2,electricity:5,water:2},{money:10},'üè≠'),
    power: new Building("–≠–ª–µ–∫—Ç—Ä–æ—Å—Ç–∞–Ω—Ü–∏—è","power",150,{money:1},{electricity:20},'‚ö°'),
    farm: new Building("–§–µ—Ä–º–∞","farm",120,{money:1,water:2},{food:20},'üåæ')
};

// =================== UI ===================
function createMap(){
    mapDiv.innerHTML='';
    for(let y=0;y<city.height;y++){
        for(let x=0;x<city.width;x++){
            const cell = document.createElement('div');
            cell.className='cell';
            cell.dataset.x = x;
            cell.dataset.y = y;
            cell.addEventListener('click',()=> placeBuilding(x,y));
            mapDiv.appendChild(cell);
        }
    }
}

function updateMap(){
    document.querySelectorAll('.cell').forEach(cell=>{
        const x = parseInt(cell.dataset.x);
        const y = parseInt(cell.dataset.y);
        const b = city.buildings.find(b=>b.x===x && b.y===y);
        cell.innerText = b?b.building.icon:'';
    });
}

function updateUI(){
    document.getElementById('money').innerText = city.money;
    document.getElementById('population').innerText = city.population;
    document.getElementById('happiness').innerText = city.happiness;
    document.getElementById('electricity').innerText = city.resources.electricity;
    document.getElementById('water').innerText = city.resources.water;
    document.getElementById('food').innerText = city.resources.food;
}

function logEvent(text){
    const div = document.createElement('div');
    div.innerText = text;
    eventsDiv.prepend(div);
}

// =================== –°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ ===================
function selectBuilding(type){ selectedBuilding = buildingTypes[type]; logEvent(`–í—ã –≤—ã–±—Ä–∞–ª–∏: ${selectedBuilding.name}`); }

function placeBuilding(x,y){
    if(!selectedBuilding) { logEvent("–í—ã–±–µ—Ä–∏—Ç–µ –∑–¥–∞–Ω–∏–µ!"); return; }
    if(city.addBuilding(selectedBuilding,x,y)){
        updateMap();
        updateUI();
    }
}

// =================== –ò–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª ===================
createMap();
updateUI();

setInterval(()=>{
    city.tick();
    updateMap();
    updateUI();
    // —Å–ª—É—á–∞–π–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
    if(Math.random()<0.01){
        logEvent("–ü—Ä–æ–∏–∑–æ—à–ª–æ —Å–æ–±—ã—Ç–∏–µ: —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π –∫—Ä–∏–∑–∏—Å!");
        city.money = Math.max(0,city.money-100);
    }
},3000);
</script>
</body>
</html>
